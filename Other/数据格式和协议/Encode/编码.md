# 编码

参照：https://mp.weixin.qq.com/s/wBfHsus_oEf0u-cPi1rguA

## 概念

​	字符编码（Character encoding）是一套法则，使用该法则能够对自然语言的字符的一个集合（如字母表或音节表），与其他东西的一个集合（如号码或电脉冲）进行配对

## 1. ASCII码

​	ASCII（American Standard Code for Information  Interchange，美国信息交换标准代码）是基于拉丁字母的一套计算机编码系统。它主要用于显示现代英语，其中共有128个字符，包含了所有的大写和小写字母，数字0到9、标点符号， 以及在美式英语中使用的特殊控制字符等

![](.\ASCII TABLE.webp)

## 2. Unicode

Unicode（Universal Multiple-Octet Coded Character Set）

### 引出

- **由于ASCII只有128个字符，虽然对于英文字符都可以表示了，但是世界上还有很多其他的文字他是没办法表示的，所以需要一种更加全面的字符编码**


### 概念

- Unicode是一种一套通用的字符集，类似大全解，字典、概念定义的地方，包含世界上的大部分文字（包括中文），字符集为每一个「字符」分配一个唯一的 ID（学名为码位 / 码点 / Code Point）

- Unicode（中文：万国码、国际码、统一码、单一码）是计算机科学领域里的一项业界标准。它对世界上大部分的文字系统进行了整理、编码，使得计算机可以用更为简单的方式来呈现和处理文字

- Unicode至今仍在不断增修，每个新版本都加入更多新的字符。目前最新的版本为2019年5月公布的12.1，这一版本只新增了一个字符，即日本新年号令和的合字


## 3. UTF-8 UTF16 UTF-32

### 引出

- Unicode虽然统一了全世界字符的编码，但没有规定如何存储。这么做是有考虑的：如果Unicode统一规定，每个符号就要用三个或四个字节表示，因为字符太多，只能用这么多字节才能表示完全
- **一旦这么规定，那么每个英文字母前都必然有二到三个字节是0，因为所有英文字母在ASCII中都有，都可以用一个字节表示，剩余字节位置就要补充0。如果这样，文本文件的大小会因此大出二三倍，这对于存储来说是极大的浪费**。为了解决这个问题，就出现了一些中间格式的字符集，他们被称为通用转换格式，即UTF（Unicode Transformation Format）。常见的UTF格式有：UTF-7, UTF-7.5, UTF-8,UTF-16, 以及 UTF-32

### 概念

- UTF-8  使用一至四个字节为每个字符编码
- UTF-16 使用二或四个字节为每个字符编码
- UTF-32 使用四个字节为每个字符编码

### 区别

​	Unicode规定了一个中文字符 "我"对应的unicode是"\u6211"，但是，在UTF-8和UTF-16等不同的实现方式下，这个二进制code的存储方式是不一样的

​	UTF-8使用可变长度字节来储存 Unicode字符，例如ASCII字母继续使用1字节储存，重音文字、希腊字母或西里尔字母等使用2字节来储存，而常用的汉字就要使用3字节。辅助平面字符则使用4字节。

## 4. GBK GB2312 GB18030

### 引出

- 因为UTF-8是Unicode的一种实现，所以他包含了世界上所有文字的编码，它采用的是1-4字节进行编码

- 对于那些排在前面优先纳入的文字，可能就优先使用1字节、2字节存储了，对于后纳入的文字，就要使用3字节或者4字节存储了

- 正是因为他太全了，所以那些晚一些纳入的字符，在UTF-8中的存储所占的字节数可能就会多一些，那他的存储空间要求就会很大

- **对于常用的汉字，在UTF-8中采用3字节进行编码，但是如果有一种只包含中文和ASCII的编码，就不需要使用3个字节，可能2个字节就够了**

- 对于大部分网站来说，基本都是只服务一个国家或者地区的，比如一个中国的网站，一般会出现简体字和繁体字以及一些英文字符，很少会出现日语或者韩文的

- 也是处于这样的考虑，中国国家标准总局于1981年制定并实施了GB2312-80编码，即中华人民共和国国家标准简体中文字符集。后来产商微软利用GB2312-80未使用的编码空间，收录GB13000.1-93全部字符制定了GBK编码

### 概念

​	有了标准中文字符集，如果是一个纯中文网站，就可以采用这种编码方式，这样可以大大节省一些存储空间，常用的中文编码有GBK，GB2312，GB18030等，最常用的是GBK

- **GB2312**（1980年）：16位字符集，收录有6763个简体汉字，682个符号，共7445个字符

- - 优点：适用于简体中文环境，属于中国国家标准，通行于大陆，新加坡等地也使用此编码
  - 缺点：不兼容繁体中文，其汉字集合过少

- **GBK**（1995年）：16位字符集，收录有21003个汉字，883个符号，共21886个字符

- - 优点：适用于简繁中文共存的环境，为简体Windows所使用，向下完全兼容gb2312，向上支持 ISO-10646 国际标准 ；所有字符都可以一对一映射到unicode2.0上
  - 缺点：不属于官方标准，和big5之间需要转换；很多搜索引擎都不能很好地支持GBK汉字

- **GB18030**（2000年）：32位字符集；收录了27484个汉字，同时收录了藏文、蒙文、维吾尔文等主要的少数民族文字

- - 优点：可以收录所有你能想到的文字和符号，属于中国最新的国家标准
  - 缺点：目前支持它的软件较少

## 乱码

### 实例

1. 中文（UTF8）--使用UTF8码表编码--> UTF8编码 --使用GBK码表解码--> 锟斤拷...

2. 中文（GBK）--使用GBK码表编码--> GBK编码 --使用UTF8码表解码--> ??????...

### 概念

​	因为Unicode是一直在更新的，在这个过程中，肯定有一些比较新的字符他是无法表示的。或者即使Unicode发布了新版纳入了某个文字，但是很多软件系统并未升级也会有这样的问题

​	就像生活中一些手机厂商新出的那些emoji表情，在自己的手机上可以正常显示，发到其他品牌的手机上可能就无法显示。这其实也是字符集不支持导致的

​	**发生以上情况时，无法显示的时候也需要有一个字符来表示的，在Unicode中，这个字符就是 � ，他也是Unicode中定义的一个特殊字符**。也就是"0xFFFD REPLACEMENT CHARACTER"，所有无法表示的字符都会通过这个字符来表示

### 解释（实例1）

​	这个特殊字符对应的在不同的码表表现如下

![REPLACEMENT CHARACTER](.\REPLACEMENT CHARACTER.webp)

- 特殊字符

  10进制：65533

  UTF8 16进制：0xEF 0xBF 0xBD

- 实例

  如果连续两个字符都无法显示：

  ​	0xEF 0xBF 0xBD 0xEF 0xBF 0xBD

  GBK来解码的结果：

  ​	0xEF 0xBF - 锟（0xEFBF）

  ​	0xBD 0xEF - 斤（0xBDEF）

  ​	0xBF 0xBD - 拷（0xBFBD）

### PS

​	还有两组比较经典的乱码，分别是"烫烫烫"和"屯屯屯"，这两个乱码产生自VC，这是debug模式下VC对内存的初始化操作。VC会把栈中新分配的内存初始化为0xcc，而把堆中新分配的内存初始化为0xcd。把0xcc和0xcd按照字符打印出来，就是烫和屯了

## 本篇记录主要引用的文章

[微信公众号]: https://mp.weixin.qq.com/s/wBfHsus_oEf0u-cPi1rguA	"漫画编程"

## 想更加全面的了解

[知乎]: https://www.zhihu.com/question/23374078	"盛世唐朝"